import{O as M,j as e,S as i,a as t,P as l,b as d,B as m,x as c,L as C,l as k,n}from"./mantine-vendor-D4AgWXPI.js";import{d as u,u as I}from"./utils-vendor-CNi8B-Rx.js";import{e as g,p as A}from"./apiService-758Vinm-.js";import{c as p,d as h,i as F}from"./index-cX4OG7Q0.js";import"./react-vendor-Q26-omST.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var P=p("outline","calendar-event","IconCalendarEvent",[["path",{d:"M4 5m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M16 3l0 4",key:"svg-1"}],["path",{d:"M8 3l0 4",key:"svg-2"}],["path",{d:"M4 11l16 0",key:"svg-3"}],["path",{d:"M8 15h2v2h-2z",key:"svg-4"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var S=p("outline","refresh-alert","IconRefreshAlert",[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}],["path",{d:"M12 9l0 3",key:"svg-2"}],["path",{d:"M12 15l.01 0",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var v=p("outline","send","IconSend",[["path",{d:"M10 14l11 -11",key:"svg-0"}],["path",{d:"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5",key:"svg-1"}]]);const L=()=>{const x=u({mutationFn:()=>g.triggerEmailNotifications(),onSuccess:()=>{n.show({title:"Success",message:"Monthly rent reminder process triggered successfully. Emails will be sent in the background.",color:"green",icon:e.jsx(F,{})})},onError:s=>{n.show({title:"Error",message:s.message||"Failed to trigger monthly reminders.",color:"red",icon:e.jsx(h,{})})}}),w=()=>{x.mutate()},a=M({initialValues:{optional_message:""}}),j=u({mutationFn:s=>g.triggerAnnualRenewalReminders(s),onSuccess:s=>{n.show({title:"Process Triggered",message:s.message||"Annual renewal reminder process triggered. Check logs for details.",color:"green",icon:e.jsx(S,{})}),a.reset()},onError:s=>{n.show({title:"Error",message:s.message||"Failed to trigger annual renewal reminders.",color:"red",icon:e.jsx(h,{})})}}),E=s=>{j.mutate({optional_message:s.optional_message})},{data:o,isLoading:y}=I({queryKey:["personsForEmail"],queryFn:A.getAll}),r=M({initialValues:{recipient_person_id:"",subject:"",body:""},validate:{recipient_person_id:s=>s?null:"Recipient is required",subject:s=>s.trim()?null:"Subject is required",body:s=>s.trim()?null:"Email body is required"}}),b=u({mutationFn:s=>g.sendCustomEmail(s),onSuccess:s=>{n.show({title:"Email Sent",message:s.message||"Custom email sent successfully!",color:"green",icon:e.jsx(v,{})}),r.reset()},onError:s=>{n.show({title:"Error Sending Email",message:s.message||"Failed to send custom email.",color:"red",icon:e.jsx(h,{})})}}),f=s=>{b.mutate(s)},R=(o==null?void 0:o.map(s=>({value:s.id,label:`${s.full_name} (ID: ${s.id})`})))||[];return e.jsxs(i,{gap:"xl",children:[e.jsx(t,{order:2,children:"Manual Email Sender"}),e.jsxs(l,{shadow:"sm",p:"md",withBorder:!0,children:[e.jsx(t,{order:3,mb:"md",children:"Monthly Rent Reminders"}),e.jsx(d,{mb:"sm",children:"Trigger the process to send monthly rent payment reminders to all relevant tenants."}),e.jsx(d,{size:"xs",c:"dimmed",mb:"md",children:"This uses the same underlying notification system as the automated scheduler."}),e.jsx(m,{leftSection:e.jsx(P,{size:18}),onClick:w,loading:x.isPending,children:"Trigger Monthly Rent Reminders"})]}),e.jsxs(l,{shadow:"sm",p:"md",withBorder:!0,children:[e.jsx(t,{order:3,mb:"md",children:"Annual Contract Renewal Reminders"}),e.jsx(d,{mb:"sm",children:"Trigger the process to send renewal reminders to tenants whose contracts are ending in approximately one month."}),e.jsx("form",{onSubmit:a.onSubmit(E),children:e.jsxs(i,{children:[e.jsx(c,{label:"Optional Custom Message Addon",placeholder:"Include an additional message to append to the standard renewal reminder...",...a.getInputProps("optional_message"),minRows:3}),e.jsx(m,{type:"submit",leftSection:e.jsx(S,{size:18}),mt:"sm",loading:j.isPending,children:"Trigger Annual Renewal Reminders"})]})})]}),e.jsxs(l,{shadow:"sm",p:"md",withBorder:!0,children:[e.jsx(t,{order:3,mb:"md",children:"Send Custom Email"}),y&&e.jsx(C,{visible:!0}),!y&&e.jsx("form",{onSubmit:r.onSubmit(f),children:e.jsxs(i,{children:[e.jsx(k,{label:"Select Recipient",placeholder:"Choose a person (tenant, manager, user)",data:R,searchable:!0,clearable:!0,nothingFoundMessage:"No persons found",...r.getInputProps("recipient_person_id"),required:!0}),e.jsx(c,{label:"Subject",placeholder:"Email subject",required:!0,...r.getInputProps("subject")}),e.jsx(c,{label:"Email Body (HTML allowed)",placeholder:"Compose your email message... You can use HTML tags for formatting.",required:!0,minRows:6,...r.getInputProps("body")}),e.jsx(m,{type:"submit",leftSection:e.jsx(v,{size:18}),mt:"sm",loading:b.isPending,children:"Send Custom Email"})]})})]})]})};export{L as default};
