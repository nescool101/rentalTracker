import{O as T,j as t,L as z,v as K,s as S,G as Q,B as y,S as I,a as k,P as G,r as v,b as B,F as W,k as U,z as o,t as A,n as d}from"./mantine-vendor-D4AgWXPI.js";import{r as _,R as V}from"./react-vendor-Q26-omST.js";import{c as $,u as M,d as x}from"./utils-vendor-CNi8B-Rx.js";import{d as u,r as H}from"./apiService-758Vinm-.js";import{d as J,h as X}from"./index-cX4OG7Q0.js";import{I as Y}from"./IconTrash-cT-LP-1K.js";const le=()=>{const i=$(),[F,c]=_.useState(!1),[r,q]=_.useState(null),[j,D]=_.useState(null),{data:h,isLoading:R,error:l}=M({queryKey:["rentals"],queryFn:H.getAll}),{data:m,isLoading:w,error:a}=M({queryKey:["allPricing"],queryFn:u.getAll}),E=V.useMemo(()=>!h||!m?[]:h.map(e=>({...e,pricing:m.find(s=>s.rental_id===e.id)||null})),[h,m]),n=T({initialValues:{rental_id:"",monthly_rent:0,security_deposit:0,utilities_included:[],tenant_responsible_for:[],late_fee:0,due_day:1},validate:{rental_id:e=>e&&e.trim()!==""?null:"Rental ID is required",monthly_rent:e=>e!=null&&e>0?null:"Monthly rent must be a positive number",due_day:e=>e!=null&&e>=1&&e<=31?null:"Due day must be between 1 and 31",security_deposit:e=>e!=null&&e>=0?null:"Security deposit cannot be negative",late_fee:e=>e!=null&&e>=0?null:"Late fee cannot be negative"}}),f={onSuccess:()=>{i.invalidateQueries({queryKey:["allPricing"]}),i.invalidateQueries({queryKey:["rentals"]}),d.show({title:"Success",message:"Pricing information saved successfully.",color:"green"}),c(!1),n.reset()},onError:e=>{d.show({title:"Error",message:e.message||"An unexpected error occurred.",color:"red"})}},p=x({mutationFn:e=>u.create(e),...f}),g=x({mutationFn:e=>u.update(e.id,e),...f}),b=x({mutationFn:e=>u.delete(e),onSuccess:()=>{i.invalidateQueries({queryKey:["allPricing"]}),i.invalidateQueries({queryKey:["rentals"]}),d.show({title:"Success",message:"Pricing record deleted.",color:"green"})},onError:e=>{d.show({title:"Error",message:e.message||"Failed to delete pricing record.",color:"red"})}}),C=(e,s)=>{D(e),q(s||null),n.setValues({rental_id:e.id,monthly_rent:(s==null?void 0:s.monthly_rent)||0,security_deposit:(s==null?void 0:s.security_deposit)||0,utilities_included:(s==null?void 0:s.utilities_included)||[],tenant_responsible_for:(s==null?void 0:s.tenant_responsible_for)||[],late_fee:(s==null?void 0:s.late_fee)||0,due_day:(s==null?void 0:s.due_day)||1,id:s==null?void 0:s.id}),c(!0)},N=e=>{if(!j)return;const s={...e,rental_id:j.id,monthly_rent:Number(e.monthly_rent)||0,security_deposit:Number(e.security_deposit)||0,late_fee:Number(e.late_fee)||0,due_day:Number(e.due_day)||1,utilities_included:e.utilities_included||[],tenant_responsible_for:e.tenant_responsible_for||[]};if(r&&r.id)g.mutate({...s,id:r.id});else{const{id:Z,...L}=s;p.mutate(L)}},O=e=>{window.confirm("Are you sure you want to delete this pricing record?")&&b.mutate(e)};if(R||w)return t.jsx(z,{visible:!0});if(l||a)return t.jsx(K,{icon:t.jsx(J,{size:16}),title:"Error!",color:"red",children:(l==null?void 0:l.message)||(a==null?void 0:a.message)||"Failed to load data."});const P=E.map(e=>t.jsxs("tr",{children:[t.jsx("td",{children:e.id}),t.jsx("td",{children:e.pricing?t.jsx(S,{color:"green",children:"Configured"}):t.jsx(S,{color:"orange",children:"Not Set"})}),t.jsx("td",{children:e.pricing?`$${e.pricing.monthly_rent.toFixed(2)}`:"N/A"}),t.jsx("td",{children:e.pricing?e.pricing.due_day:"N/A"}),t.jsx("td",{children:t.jsxs(Q,{children:[t.jsx(y,{leftSection:t.jsx(X,{size:14}),onClick:()=>C(e,e.pricing),size:"xs",variant:"outline",children:e.pricing?"Edit Pricing":"Add Pricing"}),e.pricing&&t.jsx(y,{leftSection:t.jsx(Y,{size:14}),onClick:()=>O(e.pricing.id),color:"red",size:"xs",variant:"outline",disabled:b.isPending,children:"Delete"})]})})]},e.id));return t.jsxs(I,{children:[t.jsx(k,{order:2,children:"Precios de Alquileres"}),t.jsx(G,{shadow:"sm",p:"md",children:t.jsxs(v,{striped:!0,highlightOnHover:!0,children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Rental ID"}),t.jsx("th",{children:"Pricing Status"}),t.jsx("th",{children:"Monthly Rent"}),t.jsx("th",{children:"Due Day"}),t.jsx("th",{children:"Actions"})]})}),t.jsx("tbody",{children:P.length>0?P:t.jsx("tr",{children:t.jsx("td",{colSpan:5,children:t.jsx(B,{ta:"center",children:"No rentals found."})})})})]})}),t.jsx(W,{opened:F,onClose:()=>c(!1),title:r?"Edit Pricing":"Add Pricing",size:"lg",children:t.jsx("form",{onSubmit:n.onSubmit(N),children:t.jsxs(I,{children:[t.jsx(U,{label:"Rental ID",disabled:!0,...n.getInputProps("rental_id")}),t.jsx(o,{label:"Monthly Rent",required:!0,step:.01,min:0,...n.getInputProps("monthly_rent")}),t.jsx(o,{label:"Security Deposit",step:.01,min:0,...n.getInputProps("security_deposit")}),t.jsx(A,{label:"Utilities Included",data:["Water","Electricity","Gas","Internet","Trash","Other"],searchable:!0,...n.getInputProps("utilities_included")}),t.jsx(A,{label:"Tenant Responsible For",data:["Water","Electricity","Gas","Internet","Trash","Other"],searchable:!0,...n.getInputProps("tenant_responsible_for")}),t.jsx(o,{label:"Late Fee",step:.01,min:0,...n.getInputProps("late_fee")}),t.jsx(o,{label:"Due Day of Month",required:!0,min:1,max:31,step:1,...n.getInputProps("due_day")}),t.jsx(y,{type:"submit",loading:p.isPending||g.isPending,mt:"md",children:r?"Update Pricing":"Create Pricing"})]})})})]})};export{le as default};
