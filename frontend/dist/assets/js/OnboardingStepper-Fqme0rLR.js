import{K as U,j as e,C as H,P as M,a as _,m as q,X as d,S as u,b as o,g as p,D as m,k as c,G as y,l as x,t as B,v as J,x as C,y as V,B as v,W,n as P}from"./mantine-vendor-Bripv_3X.js";import{r as g,u as G}from"./react-vendor-Cmr1RT9l.js";import{u as K,I as X,g as $}from"./index-BGAR1JXy.js";import{a as l}from"./utils-vendor-tZ1hTSV2.js";const f="";function ae(){const[h,w]=g.useState(0),[z,I]=g.useState(!1),[E,b]=g.useState(""),[N,F]=g.useState([]),[S,A]=g.useState(!1),{user:s,logout:L}=K(),D=G();if(g.useEffect(()=>{s||D("/login",{replace:!0})},[s,D]),g.useEffect(()=>{(async()=>{A(!0);try{const i=(await l.get("https://api-colombia.com/api/v1/Department")).data.map(t=>({value:t.id.toString(),label:t.name}));F(i)}catch(r){console.error("Error fetching departments:",r),P.show({title:"Error",message:"No se pudieron cargar los departamentos. Por favor, intenta nuevamente.",color:"red"})}finally{A(!1)}})()},[]),!s)return null;const n=U({initialValues:{fullName:"",phone:"",identificationType:"CC",identificationNumber:"",address:"",password:"",confirm_password:"",propertyName:"",propertyAddress:"",propertyCity:"",propertyDescription:"",propertyType:"",propertyDepartment:"",bankName:"",accountNumber:"",accountType:"",accountHolderName:"",baseRentalPrice:0,depositAmount:0,lateFeePercentage:0,termsAccepted:!1},validate:{fullName:a=>a.trim().length<2?"Ingrese su nombre completo":null,phone:a=>a.trim().length<6?"Ingrese un número de teléfono válido":null,password:a=>a.length<8?"La contraseña debe tener al menos 8 caracteres":null,confirm_password:(a,r)=>a!==r.password?"Las contraseñas no coinciden":null,propertyAddress:a=>a.trim().length<5?"Ingrese una dirección válida":null,accountNumber:a=>a.trim().length<5?"Ingrese un número de cuenta válido":null,termsAccepted:a=>a===!1?"Debe aceptar los términos y condiciones":null}}),T=a=>{switch(a){case 0:return!0;case 1:return!n.validateField("fullName").hasError&&!n.validateField("phone").hasError;case 2:return!n.validateField("password").hasError&&!n.validateField("confirm_password").hasError;case 3:return!n.validateField("propertyAddress").hasError;case 4:return!n.validateField("accountNumber").hasError;case 5:return!0;case 6:return!n.validateField("termsAccepted").hasError;default:return!0}},k=()=>{T(h)&&h<7&&w(a=>a+1)},R=()=>{w(a=>a>0?a-1:a)},O=async a=>{if(T(h)){if(h<7){k();return}I(!0),b("");try{if(!s||!s.id||!s.token){b("Se ha perdido la sesión. Por favor, vuelva a iniciar sesión.");return}try{console.log("Creating or updating person for user:",s.email);const r={full_name:a.fullName,phone:a.phone,identification_type:a.identificationType,identification_number:a.identificationNumber,address:a.address};if(s.person_id)console.log("Updating existing person with ID:",s.person_id),await l.put(`${f}/api/persons/${s.person_id}`,r,{headers:{Authorization:`Bearer ${s.token}`}});else{console.log("Creating new person record");const t=(await l.post(`${f}/api/persons`,r,{headers:{Authorization:`Bearer ${s.token}`}})).data.id;console.log("New person created with ID:",t),await l.put(`${f}/api/users/${s.id}`,{id:s.id,email:s.email,person_id:t,role:s.role},{headers:{Authorization:`Bearer ${s.token}`}})}}catch(r){console.error("Error creating/updating person:",r),l.isAxiosError(r)&&r.response&&console.error("Person creation/update error details:",r.response.data)}if(a.propertyAddress)try{console.log("Creating property for user:",s.email);const r=N.find(j=>j.value===a.propertyDepartment),i=r?r.label:"",t={name:a.propertyName||"Mi Propiedad",address:a.propertyAddress,city:a.propertyCity||"",description:a.propertyDescription||"",type:a.propertyType||"Apartment",department:i,department_id:a.propertyDepartment||"",manager_id:s.person_id,resident_id:s.person_id,status:"available"};console.log("Property data:",JSON.stringify(t)),await l.post(`${f}/api/properties`,t,{headers:{Authorization:`Bearer ${s.token}`}}),console.log("Property created successfully")}catch(r){console.error("Error creating property:",r),l.isAxiosError(r)&&r.response&&console.error("Property creation error details:",r.response.data)}if(a.accountNumber)try{console.log("Creating bank account for person ID:",s.person_id);const r={bank_name:a.bankName,account_number:a.accountNumber,account_type:a.accountType||"Checking",account_holder:a.accountHolderName||a.fullName,person_id:s.person_id};console.log("Bank account data:",JSON.stringify(r));const i=await l.post(`${f}/api/bank-accounts`,r,{headers:{Authorization:`Bearer ${s.token}`}});console.log("Bank account created successfully:",i.data)}catch(r){console.error("Error creating bank account:",r),l.isAxiosError(r)&&r.response&&console.error("Bank account creation error details:",r.response.data)}try{console.log("Updating user with ID:",s.id);const r=btoa(a.password);console.log("Password to be sent (encoded length):",r.length);const i={id:s.id,email:s.email,person_id:s.person_id,role:s.role,status:"activenopaid",password_base64:r};console.log("User update payload:",JSON.stringify({...i,password_base64:"***REDACTED***"}));const t=await l.put(`${f}/api/users/${s.id}`,i,{headers:{Authorization:`Bearer ${s.token}`}});if(console.log("User update response status:",t.status),t.status===200){const j=e.jsxs(e.Fragment,{children:[e.jsx(_,{order:4,mb:"sm",children:"¡Felicidades!"}),e.jsx(o,{children:"Has creado tu usuario Manager y toda la información requerida."}),e.jsx(o,{mt:"sm",children:"Serás redirigido a la página principal en unos segundos."})]});P.show({title:"¡Configuración completada!",message:"Su cuenta ha sido actualizada exitosamente.",color:"green",icon:e.jsx($,{size:16})}),P.show({title:"FELICIDADES",message:j,color:"green",icon:e.jsx($,{size:20}),autoClose:5e3,withCloseButton:!0,styles:{root:{maxWidth:"450px"},title:{fontSize:"18px",fontWeight:"bold"}}}),await L(),setTimeout(()=>{window.location.href="/?newManager=true"},3e3)}else b("Hubo un problema al actualizar su información. Código de respuesta: "+t.status)}catch(r){if(console.error("Error updating user password:",r),l.isAxiosError(r)&&r.response){const i=r.response.data.error||"Error al actualizar la información de usuario.";console.error("Error details:",r.response.data),b(`Error al actualizar su contraseña: ${i}. Por favor, intente una contraseña diferente.`)}else b("Error de conexión al actualizar su contraseña. Verifique su conexión a internet e intente de nuevo.")}}catch(r){console.error("Error in account setup process:",r),b("Ocurrió un error al configurar su cuenta. Por favor, intente nuevamente.")}finally{I(!1)}}};return e.jsx(H,{size:"lg",my:40,children:e.jsxs(M,{radius:"md",p:"xl",withBorder:!0,children:[e.jsx(_,{order:2,ta:"center",mb:"lg",children:"Complete su perfil"}),E&&e.jsx(q,{icon:e.jsx(X,{size:16}),title:"Error",color:"red",mb:"md",children:E}),e.jsxs("form",{onSubmit:n.onSubmit(O),children:[e.jsxs(d,{active:h,mb:"xl",children:[e.jsx(d.Step,{label:"Bienvenido",description:"Primeros pasos",children:e.jsxs(u,{gap:"md",mt:"md",children:[e.jsx(o,{size:"lg",children:"¡Bienvenido a la plataforma de gestión de propiedades!"}),e.jsx(o,{children:"Vamos a ayudarle a configurar su cuenta para que pueda comenzar a utilizar todas las funcionalidades de la plataforma."}),e.jsx(o,{children:"Este proceso solo tomará unos minutos. Necesitaremos completar los siguientes datos:"}),e.jsxs(p,{pl:"md",children:[e.jsx(o,{children:"• Información personal"}),e.jsx(o,{children:"• Contraseña de acceso"}),e.jsx(o,{children:"• Información de propiedades"}),e.jsx(o,{children:"• Datos bancarios"}),e.jsx(o,{children:"• Configuración de precios"}),e.jsx(o,{children:"• Términos y condiciones"})]}),e.jsx(m,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",children:"Su usuario ha sido creado con una contraseña temporal. Por seguridad, deberá cambiarla para continuar usando la plataforma."})]})}),e.jsx(d.Step,{label:"Información personal",description:"Datos personales",children:e.jsxs(u,{gap:"md",mt:"md",children:[e.jsx(c,{label:"Nombre completo",placeholder:"Juan Pérez",required:!0,...n.getInputProps("fullName")}),e.jsx(c,{label:"Teléfono",placeholder:"+57 300 123 4567",required:!0,value:n.values.phone,onChange:a=>{const r=a.currentTarget.value.replace(/[^0-9+\-\s()]/g,"");n.setFieldValue("phone",r)},error:n.errors.phone}),e.jsxs(y,{grow:!0,children:[e.jsx(x,{label:"Tipo de identificación",placeholder:"Seleccione tipo",data:[{value:"RC",label:"RC - Registro Civil"},{value:"TI",label:"TI - Tarjeta de Identidad"},{value:"CC",label:"CC - Cédula de Ciudadanía"},{value:"CE",label:"CE - Cédula de Extranjería"},{value:"PP",label:"PP - Pasaporte"},{value:"PEP",label:"PEP - Permiso Especial de Permanencia"},{value:"NIT",label:"NIT - Número de Identificación Tributaria"}],...n.getInputProps("identificationType")}),e.jsx(c,{label:"Número de identificación",placeholder:"12345678",...n.getInputProps("identificationNumber")})]}),e.jsx(c,{label:"Dirección",placeholder:"Calle 123 #45-67",...n.getInputProps("address")}),e.jsx(m,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",children:"Esta información nos ayudará a personalizar su experiencia y a contactarle cuando sea necesario."})]})}),e.jsx(d.Step,{label:"Seguridad",description:"Contraseña",children:e.jsxs(u,{gap:"md",mt:"md",children:[e.jsx(B,{label:"Nueva contraseña",placeholder:"Su nueva contraseña",required:!0,...n.getInputProps("password")}),e.jsx(B,{label:"Confirmar contraseña",placeholder:"Confirme su nueva contraseña",required:!0,...n.getInputProps("confirm_password")}),e.jsx(m,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",children:"Su contraseña debe tener al menos 8 caracteres. Use una combinación de letras, números y símbolos para mayor seguridad."})]})}),e.jsx(d.Step,{label:"Propiedades",description:"Información de propiedad",children:e.jsxs(u,{gap:"md",mt:"md",children:[e.jsx(c,{label:"Nombre de la propiedad",placeholder:"Apartamento Centro",...n.getInputProps("propertyName")}),e.jsx(c,{label:"Dirección de la propiedad",placeholder:"Calle 123 #45-67",required:!0,...n.getInputProps("propertyAddress")}),e.jsxs(y,{grow:!0,children:[e.jsx(x,{label:"Departamento",placeholder:S?"Cargando departamentos...":"Seleccione el departamento",data:N,disabled:S,searchable:!0,...n.getInputProps("propertyDepartment")}),e.jsx(c,{label:"Ciudad",placeholder:"Ingrese ciudad",...n.getInputProps("propertyCity")})]}),e.jsx(x,{label:"Tipo de propiedad",placeholder:"Seleccione el tipo",data:[{value:"Apartment",label:"Apartamento"},{value:"House",label:"Casa"},{value:"Room",label:"Habitación"},{value:"Office",label:"Oficina"},{value:"Commercial",label:"Local comercial"},{value:"Other",label:"Otro"}],...n.getInputProps("propertyType")}),e.jsx(J,{label:"Descripción",placeholder:"Apartamento de 2 habitaciones, 1 baño...",minRows:3,...n.getInputProps("propertyDescription")}),e.jsx(m,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",children:"Puede agregar más propiedades más adelante desde el panel de administración."})]})}),e.jsx(d.Step,{label:"Cuenta bancaria",description:"Datos bancarios",children:e.jsxs(u,{gap:"md",mt:"md",children:[e.jsx(c,{label:"Nombre del banco",placeholder:"Banco de Colombia",...n.getInputProps("bankName")}),e.jsx(c,{label:"Número de cuenta",placeholder:"1234567890",required:!0,...n.getInputProps("accountNumber")}),e.jsx(x,{label:"Tipo de cuenta",placeholder:"Seleccione el tipo",data:[{value:"Checking",label:"Cuenta Corriente"},{value:"Savings",label:"Cuenta de Ahorros"}],...n.getInputProps("accountType")}),e.jsx(c,{label:"Titular de la cuenta",placeholder:"Nombre del titular",...n.getInputProps("accountHolderName")}),e.jsx(m,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",children:"Esta cuenta se utilizará para los pagos y transferencias relacionados con sus propiedades."})]})}),e.jsx(d.Step,{label:"Precios",description:"Configuración de tarifas",children:e.jsxs(u,{gap:"md",mt:"md",children:[e.jsx(C,{label:"Precio base de alquiler",placeholder:"1000000",suffix:" COP",...n.getInputProps("baseRentalPrice")}),e.jsx(C,{label:"Monto de depósito",placeholder:"2000000",suffix:" COP",...n.getInputProps("depositAmount")}),e.jsx(C,{label:"Porcentaje de mora por pagos tardíos",placeholder:"5",suffix:"%",min:0,max:100,...n.getInputProps("lateFeePercentage")}),e.jsx(m,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",children:"Estos valores se utilizarán como referencia para sus propiedades. Puede personalizar los precios para cada propiedad más adelante."})]})}),e.jsx(d.Step,{label:"Términos y condiciones",description:"Aceptar términos",children:e.jsxs(u,{gap:"md",mt:"md",children:[e.jsx(o,{size:"lg",children:"Términos y Condiciones de Uso"}),e.jsx(p,{style:{maxHeight:"300px",overflow:"auto",padding:"15px",border:"1px solid #eee",borderRadius:"8px",backgroundColor:"#f9f9f9"},children:e.jsxs(o,{size:"sm",children:[e.jsx(o,{component:"div",fw:700,mb:8,children:"Términos y Condiciones de Uso"}),e.jsx(o,{component:"div",mb:16,children:"Al utilizar nuestra plataforma de gestión de propiedades, usted acepta cumplir con nuestros términos y condiciones, que incluyen:"}),e.jsxs(p,{component:"ul",pl:16,mb:16,children:[e.jsx(p,{component:"li",mb:4,children:"Proporcionar información precisa y veraz sobre usted y sus propiedades."}),e.jsx(p,{component:"li",mb:4,children:"Mantener la confidencialidad de su cuenta y contraseña."}),e.jsx(p,{component:"li",mb:4,children:"Notificar inmediatamente sobre cualquier uso no autorizado de su cuenta."}),e.jsx(p,{component:"li",mb:4,children:"No utilizar la plataforma para actividades ilegales o fraudulentas."}),e.jsx(p,{component:"li",mb:4,children:"Cumplir con todas las leyes y regulaciones aplicables."})]}),e.jsx(o,{component:"div",mb:16,children:"Nos reservamos el derecho de suspender o terminar su acceso a la plataforma si consideramos que ha violado estos términos. El uso de esta plataforma implica el pago de tarifas según el plan seleccionado. Los pagos no son reembolsables una vez procesados."}),e.jsx(o,{component:"div",fw:700,mb:8,children:"Consulta y Reporte en Centrales de Riesgo"}),e.jsx(o,{component:"div",mb:16,children:"Usted autoriza expresamente a nuestra empresa para consultar y reportar su información financiera, crediticia, comercial y de servicios ante las centrales de riesgo autorizadas en Colombia, tales como DataCrédito y TransUnion, en los términos establecidos por la Ley 1266 de 2008 y la Ley 2157 de 2021."}),e.jsx(o,{component:"div",mb:16,children:"Esta autorización es necesaria para evaluar su comportamiento crediticio y cumplir con las obligaciones legales relacionadas con la prevención del fraude y la gestión del riesgo."}),e.jsx(o,{component:"div",mb:16,children:"En cumplimiento de la normativa vigente, se le informará previamente mediante comunicación escrita con al menos veinte (20) días de antelación antes de realizar cualquier reporte negativo a las centrales de riesgo, otorgándole la oportunidad de ejercer sus derechos de defensa y rectificación, conforme a lo dispuesto en el artículo 12 de la Ley 1266 de 2008."}),e.jsx(o,{component:"div",mb:16,children:"Usted tiene derecho a conocer, actualizar y rectificar su información personal contenida en las bases de datos de las centrales de riesgo, de acuerdo con lo establecido en la Ley 1266 de 2008 y la Ley 1581 de 2012."}),e.jsx(o,{component:"div",fw:700,mb:8,children:"Superintendencia de Industria y Comercio"}),e.jsxs(o,{component:"div",mb:16,children:["Para más información sobre sus derechos y las políticas de tratamiento de datos personales, le recomendamos consultar la página oficial de la Superintendencia de Industria y Comercio:",e.jsx(o,{component:"a",href:"https://www.sic.gov.co/sobre-el-habeas-data-financiero",target:"_blank",c:"blue",children:"https://www.sic.gov.co/sobre-el-habeas-data-financiero"}),"."]})]})}),e.jsx(V,{label:"He leído y acepto los términos y condiciones",required:!0,...n.getInputProps("termsAccepted",{type:"checkbox"})}),e.jsx(m,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",children:"Es necesario aceptar los términos y condiciones para utilizar la plataforma."})]})}),e.jsx(d.Step,{label:"Finalizar",description:"Completar registro",children:e.jsxs(u,{gap:"md",mt:"md",children:[e.jsx(o,{size:"lg",children:"¡Todo listo!"}),e.jsx(o,{children:'Ha completado todos los pasos necesarios para configurar su cuenta. Pulse el botón "Completar" para finalizar y comenzar a utilizar la plataforma.'}),e.jsxs(q,{color:"blue",children:[e.jsx(o,{children:"Después de completar este proceso, su cuenta quedará en estado de espera de aprobación por parte del administrador."}),e.jsx(o,{fw:500,mt:"xs",children:"Podrá acceder al sistema, pero algunas funcionalidades estarán limitadas hasta que su cuenta sea activada completamente."})]}),e.jsxs(p,{mt:"xl",children:[e.jsx(m,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",ta:"center",mb:"md",children:"Para cualquier consulta, comuníquese con nuestro equipo de soporte a través de nescool101@gmail.com"})]})]})})]}),e.jsxs(y,{justify:"apart",mt:"xl",children:[e.jsx(v,{variant:"default",onClick:R,disabled:h===0,children:"Atrás"}),h===7?e.jsx(v,{type:"submit",disabled:z,children:z?e.jsx(W,{size:"sm"}):"Completar"}):e.jsx(v,{onClick:k,children:"Siguiente"})]})]})]})})}export{ae as default};
