import{j as e,C as y,m as R,K as le,V as oe,W as ie,P as ce,G as i,a as de,B as m,_ as ue,k as g,l as S,b as s,g as U,q as r,Z as k,e as A,$ as he,E as me,L as xe,S as X,n as x,r as je}from"./mantine-vendor-Bripv_3X.js";import{r as o}from"./react-vendor-Cmr1RT9l.js";import{g as f,p as pe}from"./apiService-19GZqUtM.js";import{u as be,I as _,o as ge,g as z}from"./index-BGAR1JXy.js";import{I as fe,a as _e}from"./IconPlus-dymNjJLj.js";import{I as Ce}from"./IconSearch-f2W8sUQc.js";import{I as we}from"./IconEye-BVgdW_qg.js";import{I as Te}from"./IconTrash-C4TwLzKL.js";import"./utils-vendor-tZ1hTSV2.js";function Be(){var $;const{user:I}=be(),[u,Z]=o.useState([]),[E,J]=o.useState([]),[Q,P]=o.useState(!0),[B,L]=o.useState(""),[Y,M]=o.useState(!1),[l,q]=o.useState("create"),[t,D]=o.useState(null),[d,ee]=o.useState(""),[j,ae]=o.useState(""),[N,re]=o.useState(1),[F,O]=o.useState(!1),C=10;if(!I||I.role!=="admin")return e.jsx(y,{size:"md",my:40,children:e.jsx(R,{icon:e.jsx(_,{size:16}),title:"Acceso denegado",color:"red",children:"Solo los administradores pueden acceder a esta página."})});const c=le({initialValues:{person_id:"",bank_name:"",account_type:"Savings",account_number:"",account_holder:""},validate:{person_id:a=>a?null:"Debe seleccionar una persona",bank_name:a=>a.length<2?"El nombre del banco es obligatorio":null,account_number:a=>a.length<5?"El número de cuenta debe tener al menos 5 caracteres":null,account_holder:a=>a.length<2?"El nombre del titular es obligatorio":null}});o.useEffect(()=>{w()},[]);const w=async()=>{P(!0),L("");try{const[a,n]=await Promise.all([f.getAll(),pe.getAll()]),v=a.map(h=>{var K;return{...h,person_name:((K=n.find(te=>te.id===h.person_id))==null?void 0:K.full_name)||"Desconocido"}});Z(v),J(n)}catch(a){console.error("Error fetching data:",a),L("Error al cargar los datos. Intente de nuevo.")}finally{P(!1)}},T=(a,n)=>{q(a),D(n||null),a==="create"?c.reset():n&&c.setValues({person_id:n.person_id,bank_name:n.bank_name,account_type:n.account_type,account_number:n.account_number,account_holder:n.account_holder}),M(!0)},p=()=>{M(!1),D(null),c.reset()},ne=async a=>{O(!0);try{l==="create"?(await f.create(a),x.show({title:"Cuenta bancaria creada",message:"La cuenta bancaria se ha creado exitosamente.",color:"green",icon:e.jsx(z,{size:16})})):l==="edit"&&t&&(await f.update(t.id,a),x.show({title:"Cuenta bancaria actualizada",message:"La cuenta bancaria se ha actualizado exitosamente.",color:"green",icon:e.jsx(z,{size:16})})),p(),await w()}catch(n){console.error("Error saving bank account:",n),x.show({title:"Error",message:"Hubo un error al guardar la cuenta bancaria.",color:"red",icon:e.jsx(_,{size:16})})}finally{O(!1)}},se=async a=>{if(confirm(`¿Está seguro de que desea eliminar la cuenta bancaria de ${a.bank_name}?`))try{await f.delete(a.id),x.show({title:"Cuenta bancaria eliminada",message:"La cuenta bancaria se ha eliminado exitosamente.",color:"green",icon:e.jsx(z,{size:16})}),await w()}catch(n){console.error("Error deleting bank account:",n),x.show({title:"Error",message:"Hubo un error al eliminar la cuenta bancaria.",color:"red",icon:e.jsx(_,{size:16})})}},b=u.filter(a=>{var h;const n=!d||a.bank_name.toLowerCase().includes(d.toLowerCase())||a.account_number.includes(d)||a.account_holder.toLowerCase().includes(d.toLowerCase())||((h=a.person_name)==null?void 0:h.toLowerCase().includes(d.toLowerCase())),v=!j||a.person_id===j;return n&&v}),V=Math.ceil(b.length/C),G=(N-1)*C,H=b.slice(G,G+C),W=a=>{const n={Savings:"blue",Checking:"green",Corriente:"green",Ahorros:"blue"};return e.jsx(je,{color:n[a]||"gray",children:a})};return Q?e.jsx(y,{size:"xl",my:40,children:e.jsx(oe,{children:e.jsx(ie,{size:"lg"})})}):e.jsx(y,{size:"xl",my:40,children:e.jsxs(ce,{radius:"md",p:"xl",withBorder:!0,children:[e.jsxs(i,{justify:"space-between",mb:"lg",children:[e.jsx(de,{order:2,children:"Gestión de Cuentas Bancarias"}),e.jsx(m,{leftSection:e.jsx(fe,{size:16}),onClick:()=>T("create"),children:"Agregar Cuenta"})]}),B&&e.jsx(R,{icon:e.jsx(_,{size:16}),title:"Error",color:"red",mb:"md",children:B}),e.jsxs(ue,{gap:"md",mb:"lg",wrap:"wrap",children:[e.jsx(g,{placeholder:"Buscar por banco, número de cuenta, titular o persona...",leftSection:e.jsx(Ce,{size:16}),value:d,onChange:a=>ee(a.target.value),style:{flex:1,minWidth:"300px"}}),e.jsx(S,{placeholder:"Filtrar por persona",leftSection:e.jsx(ge,{size:16}),data:[{value:"",label:"Todas las personas"},...E.map(a=>({value:a.id,label:a.full_name}))],value:j,onChange:a=>ae(a||""),clearable:!0,style:{minWidth:"200px"}})]}),e.jsxs(i,{mb:"lg",children:[e.jsxs(s,{size:"sm",color:"dimmed",children:["Total: ",b.length," cuenta",b.length!==1?"s":""]}),(d||j)&&e.jsxs(s,{size:"sm",color:"dimmed",children:["(Filtrado de ",u.length," total",u.length!==1?"es":"",")"]})]}),e.jsx(U,{style:{overflowX:"auto"},children:e.jsxs(r,{striped:!0,highlightOnHover:!0,children:[e.jsx(r.Thead,{children:e.jsxs(r.Tr,{children:[e.jsx(r.Th,{children:"Persona"}),e.jsx(r.Th,{children:"Banco"}),e.jsx(r.Th,{children:"Tipo de Cuenta"}),e.jsx(r.Th,{children:"Número de Cuenta"}),e.jsx(r.Th,{children:"Titular"}),e.jsx(r.Th,{children:"Acciones"})]})}),e.jsx(r.Tbody,{children:H.length===0?e.jsx(r.Tr,{children:e.jsx(r.Td,{colSpan:6,children:e.jsx(s,{ta:"center",color:"dimmed",py:"xl",children:u.length===0?"No hay cuentas bancarias registradas":"No se encontraron cuentas que coincidan con los filtros"})})}):H.map(a=>e.jsxs(r.Tr,{children:[e.jsx(r.Td,{children:e.jsx(s,{fw:500,children:a.person_name})}),e.jsx(r.Td,{children:e.jsx(s,{children:a.bank_name})}),e.jsx(r.Td,{children:W(a.account_type)}),e.jsx(r.Td,{children:e.jsx(s,{ff:"monospace",children:a.account_number})}),e.jsx(r.Td,{children:e.jsx(s,{children:a.account_holder})}),e.jsx(r.Td,{children:e.jsxs(i,{gap:"xs",children:[e.jsx(k,{label:"Ver detalles",children:e.jsx(A,{variant:"light",color:"blue",onClick:()=>T("view",a),children:e.jsx(we,{size:16})})}),e.jsx(k,{label:"Editar",children:e.jsx(A,{variant:"light",color:"yellow",onClick:()=>T("edit",a),children:e.jsx(_e,{size:16})})}),e.jsx(k,{label:"Eliminar",children:e.jsx(A,{variant:"light",color:"red",onClick:()=>se(a),children:e.jsx(Te,{size:16})})})]})})]},a.id))})]})}),V>1&&e.jsx(i,{justify:"center",mt:"lg",children:e.jsx(he,{value:N,onChange:re,total:V,size:"sm"})}),e.jsx(me,{opened:Y,onClose:p,title:l==="create"?"Crear Cuenta Bancaria":l==="edit"?"Editar Cuenta Bancaria":"Detalles de la Cuenta Bancaria",size:"md",children:e.jsxs(U,{pos:"relative",children:[e.jsx(xe,{visible:F}),l==="view"&&t?e.jsxs(X,{gap:"md",children:[e.jsxs(i,{children:[e.jsx(s,{fw:500,children:"Persona:"}),e.jsx(s,{children:($=u.find(a=>a.id===t.id))==null?void 0:$.person_name})]}),e.jsxs(i,{children:[e.jsx(s,{fw:500,children:"Banco:"}),e.jsx(s,{children:t.bank_name})]}),e.jsxs(i,{children:[e.jsx(s,{fw:500,children:"Tipo de Cuenta:"}),W(t.account_type)]}),e.jsxs(i,{children:[e.jsx(s,{fw:500,children:"Número de Cuenta:"}),e.jsx(s,{ff:"monospace",children:t.account_number})]}),e.jsxs(i,{children:[e.jsx(s,{fw:500,children:"Titular:"}),e.jsx(s,{children:t.account_holder})]}),e.jsxs(i,{justify:"flex-end",mt:"lg",children:[e.jsx(m,{variant:"default",onClick:p,children:"Cerrar"}),e.jsx(m,{onClick:()=>{q("edit"),c.setValues({person_id:t.person_id,bank_name:t.bank_name,account_type:t.account_type,account_number:t.account_number,account_holder:t.account_holder})},children:"Editar"})]})]}):e.jsx("form",{onSubmit:c.onSubmit(ne),children:e.jsxs(X,{gap:"md",children:[e.jsx(S,{label:"Persona",placeholder:"Seleccione una persona",required:!0,data:E.map(a=>({value:a.id,label:a.full_name})),searchable:!0,disabled:l==="view",...c.getInputProps("person_id")}),e.jsx(g,{label:"Nombre del Banco",placeholder:"Ej: Banco de Colombia",required:!0,disabled:l==="view",...c.getInputProps("bank_name")}),e.jsx(S,{label:"Tipo de Cuenta",placeholder:"Seleccione el tipo",required:!0,data:[{value:"Savings",label:"Ahorros"},{value:"Checking",label:"Corriente"},{value:"Ahorros",label:"Ahorros"},{value:"Corriente",label:"Corriente"}],disabled:l==="view",...c.getInputProps("account_type")}),e.jsx(g,{label:"Número de Cuenta",placeholder:"1234567890",required:!0,disabled:l==="view",...c.getInputProps("account_number")}),e.jsx(g,{label:"Titular de la Cuenta",placeholder:"Nombre completo del titular",required:!0,disabled:l==="view",...c.getInputProps("account_holder")}),e.jsxs(i,{justify:"flex-end",mt:"lg",children:[e.jsx(m,{variant:"default",onClick:p,children:"Cancelar"}),l!=="view"&&e.jsx(m,{type:"submit",loading:F,children:l==="create"?"Crear":"Actualizar"})]})]})})]})})]})})}export{Be as default};
