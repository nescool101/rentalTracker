import{j as e,V as R,W as N,g as u,v as i,a as B,P as L,S as v,B as m,b as M,G as U,n}from"./mantine-vendor-D4AgWXPI.js";import{j as $,r as o}from"./react-vendor-Q26-omST.js";import{f as c}from"./apiService-758Vinm-.js";import{c as G,d as l,e as C,k as h}from"./index-cX4OG7Q0.js";import{I as E}from"./IconSignature-BWCYSrH4.js";import"./utils-vendor-CNi8B-Rx.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var T=G("outline","download","IconDownload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 11l5 5l5 -5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]]);const J=()=>{const{signingId:r}=$(),[D,f]=o.useState(!0),[d,g]=o.useState(null),[x,p]=o.useState(null),[a,j]=o.useState(null),[P,S]=o.useState(!1),[b,w]=o.useState(!1),[I,y]=o.useState(!1);o.useEffect(()=>{(async()=>{if(!r){p("ID de firma no proporcionado"),f(!1);return}try{const s=await c.getSignatureStatus(r);g(s),j(`/api/public/contract-signing/pdf/${r}`)}catch(s){console.error("Error fetching signature status:",s),p("No se pudo obtener la información de firma del contrato.")}finally{f(!1)}})()},[r]);const k=async()=>{if(r){S(!0);try{await c.signContract(r),n.show({title:"Contrato firmado",message:"El contrato ha sido firmado exitosamente.",color:"green",icon:e.jsx(C,{})});const t=await c.getSignatureStatus(r);g(t),j(`/api/public/contract-signing/pdf/${r}?signed=true`)}catch(t){console.error("Error signing contract:",t),n.show({title:"Error",message:"No se pudo firmar el contrato. Por favor intente nuevamente.",color:"red",icon:e.jsx(l,{})})}finally{S(!1)}}},F=async()=>{if(r){w(!0);try{await c.rejectContract(r),n.show({title:"Firma rechazada",message:"Ha rechazado la firma del contrato.",color:"yellow",icon:e.jsx(h,{})});const t=await c.getSignatureStatus(r);g(t)}catch(t){console.error("Error rejecting contract:",t),n.show({title:"Error",message:"No se pudo rechazar la firma. Por favor intente nuevamente.",color:"red",icon:e.jsx(l,{})})}finally{w(!1)}}},z=()=>{if(a){y(!0);try{const t=document.createElement("a");t.href=a,t.setAttribute("download","contrato.pdf"),document.body.appendChild(t),t.click(),document.body.removeChild(t),n.show({title:"Descarga iniciada",message:"La descarga del contrato ha comenzado.",color:"blue"})}catch(t){console.error("Error downloading PDF:",t),n.show({title:"Error",message:"No se pudo descargar el contrato. Por favor intente nuevamente.",color:"red",icon:e.jsx(l,{})})}finally{y(!1)}}},A=()=>{if(!d)return null;const t=d.status,s=d.status_spanish||"Pendiente";return t==="signed"?e.jsxs(v,{children:[e.jsxs(i,{title:"Contrato Firmado",color:"green",icon:e.jsx(C,{}),children:["Este contrato ya ha sido firmado el ",new Date(d.signed_at).toLocaleDateString(),"."]}),a&&e.jsxs(e.Fragment,{children:[e.jsx(u,{my:"md",children:e.jsx("iframe",{src:a,style:{width:"100%",height:"500px",border:"1px solid #eee"},title:"Contrato de Arrendamiento Firmado"})}),e.jsx(m,{leftSection:e.jsx(T,{}),onClick:z,loading:I,children:"Descargar Contrato Firmado"})]})]}):t==="rejected"?e.jsx(i,{title:"Firma Rechazada",color:"red",icon:e.jsx(h,{}),children:"Usted ha rechazado la firma de este contrato."}):t==="expired"?e.jsx(i,{title:"Solicitud Expirada",color:"yellow",icon:e.jsx(l,{}),children:"Esta solicitud de firma ha expirado. Por favor contacte al remitente para una nueva solicitud."}):e.jsxs(v,{children:[e.jsx(i,{title:`Estado: ${s}`,color:"blue",icon:e.jsx(E,{}),children:"Este contrato está pendiente de su firma. Por favor revise el documento antes de firmar."}),a?e.jsx(u,{my:"md",children:e.jsx("iframe",{src:a,style:{width:"100%",height:"500px",border:"1px solid #eee"},title:"Contrato de Arrendamiento"})}):e.jsx(M,{color:"dimmed",ta:"center",my:"xl",children:"No se pudo cargar la vista previa del contrato. Puede proceder a firmarlo o rechazarlo."}),e.jsxs(U,{children:[e.jsx(m,{color:"red",leftSection:e.jsx(h,{}),onClick:F,loading:b,children:"Rechazar"}),e.jsx(m,{color:"green",leftSection:e.jsx(E,{}),onClick:k,loading:P,children:"Firmar Contrato"})]})]})};return D?e.jsx(R,{p:"2rem",children:e.jsx(N,{size:"lg"})}):x?e.jsx(u,{children:e.jsx(i,{title:"Error",color:"red",icon:e.jsx(l,{}),children:x})}):e.jsxs(u,{children:[e.jsx(B,{order:2,mb:"md",children:"Firma de Contrato de Arrendamiento"}),e.jsx(L,{shadow:"xs",p:"md",withBorder:!0,children:A()})]})};export{J as default};
