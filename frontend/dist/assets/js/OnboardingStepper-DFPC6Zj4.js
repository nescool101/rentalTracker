import{O as q,j as e,C as B,P as R,a as $,v as E,X as t,S as d,b as o,g as l,D as p,k as c,G as A,l as x,w as S,x as L,z as j,E as O,B as y,W as F,n as U}from"./mantine-vendor-D4AgWXPI.js";import{r as g,u as H}from"./react-vendor-Q26-omST.js";import{u as J,d as M,e as V}from"./index-cX4OG7Q0.js";import{a as i}from"./utils-vendor-CNi8B-Rx.js";const f="http://localhost:8080";function Y(){const[u,P]=g.useState(0),[C,v]=g.useState(!1),[z,m]=g.useState(""),{user:s,logout:T,login:k}=J(),w=H();if(g.useEffect(()=>{s||w("/login",{replace:!0})},[s,w]),!s)return null;const n=q({initialValues:{fullName:"",phone:"",identificationType:"CC",identificationNumber:"",address:"",password:"",confirm_password:"",propertyName:"",propertyAddress:"",propertyDescription:"",propertyType:"",bankName:"",accountNumber:"",accountType:"",accountHolderName:"",baseRentalPrice:0,depositAmount:0,lateFeePercentage:0,termsAccepted:!1},validate:{fullName:a=>a.trim().length<2?"Ingrese su nombre completo":null,phone:a=>a.trim().length<6?"Ingrese un número de teléfono válido":null,password:a=>a.length<8?"La contraseña debe tener al menos 8 caracteres":null,confirm_password:(a,r)=>a!==r.password?"Las contraseñas no coinciden":null,propertyAddress:a=>a.trim().length<5?"Ingrese una dirección válida":null,accountNumber:a=>a.trim().length<5?"Ingrese un número de cuenta válido":null,termsAccepted:a=>a===!1?"Debe aceptar los términos y condiciones":null}}),I=a=>{switch(a){case 0:return!0;case 1:return!n.validateField("fullName").hasError&&!n.validateField("phone").hasError;case 2:return!n.validateField("password").hasError&&!n.validateField("confirm_password").hasError;case 3:return!n.validateField("propertyAddress").hasError;case 4:return!n.validateField("accountNumber").hasError;case 5:return!0;case 6:return!n.validateField("termsAccepted").hasError;default:return!0}},N=()=>{I(u)&&u<7&&P(a=>a+1)},_=()=>{P(a=>a>0?a-1:a)},D=async a=>{if(I(u)){if(u<7){N();return}v(!0),m("");try{if(!s||!s.id||!s.token){m("Se ha perdido la sesión. Por favor, vuelva a iniciar sesión.");return}try{console.log("Creating or updating person for user:",s.email);const r={full_name:a.fullName,phone:a.phone,identification_type:a.identificationType,identification_number:a.identificationNumber,address:a.address};if(s.person_id)console.log("Updating existing person with ID:",s.person_id),await i.put(`${f}/api/persons/${s.person_id}`,r,{headers:{Authorization:`Bearer ${s.token}`}});else{console.log("Creating new person record");const b=(await i.post(`${f}/api/persons`,r,{headers:{Authorization:`Bearer ${s.token}`}})).data.id;console.log("New person created with ID:",b),await i.put(`${f}/api/users/${s.id}`,{id:s.id,email:s.email,person_id:b,role:s.role},{headers:{Authorization:`Bearer ${s.token}`}})}}catch(r){console.error("Error creating/updating person:",r),i.isAxiosError(r)&&r.response&&console.error("Person creation/update error details:",r.response.data)}if(a.propertyAddress)try{console.log("Creating property for user:",s.email);const r={name:a.propertyName||"Mi Propiedad",address:a.propertyAddress,description:a.propertyDescription||"",type:a.propertyType||"Apartment",manager_id:s.person_id,status:"available"};console.log("Property data:",JSON.stringify(r)),await i.post(`${f}/api/properties`,r,{headers:{Authorization:`Bearer ${s.token}`}}),console.log("Property created successfully")}catch(r){console.error("Error creating property:",r),i.isAxiosError(r)&&r.response&&console.error("Property creation error details:",r.response.data)}if(a.accountNumber)try{console.log("Creating bank account for person ID:",s.person_id);const r={bank_name:a.bankName,account_number:a.accountNumber,account_type:a.accountType||"Checking",account_holder:a.accountHolderName||a.fullName,person_id:s.person_id};console.log("Bank account data:",JSON.stringify(r));const h=await i.post(`${f}/api/bank-accounts`,r,{headers:{Authorization:`Bearer ${s.token}`}});console.log("Bank account created successfully:",h.data)}catch(r){console.error("Error creating bank account:",r),i.isAxiosError(r)&&r.response&&console.error("Bank account creation error details:",r.response.data)}try{console.log("Updating user with ID:",s.id);const r=btoa(a.password);console.log("Password to be sent (encoded length):",r.length);const h={id:s.id,email:s.email,person_id:s.person_id,role:s.role,status:"activenopaid",password_base64:r};console.log("User update payload:",JSON.stringify({...h,password_base64:"***REDACTED***"}));const b=await i.put(`${f}/api/users/${s.id}`,h,{headers:{Authorization:`Bearer ${s.token}`}});if(console.log("User update response status:",b.status),b.status===200){if(U.show({title:"Configuración completada",message:"Su cuenta ha sido actualizada exitosamente. Ahora debe esperar aprobación del administrador.",color:"green",icon:e.jsx(V,{size:16})}),await T(),!await k(s.email,a.password)){m("Su perfil se actualizó correctamente, pero hubo un problema al iniciar sesión con su nueva contraseña. Por favor, cierre esta ventana e inicie sesión manualmente.");return}window.location.href="/dashboard"}else m("Hubo un problema al actualizar su información. Código de respuesta: "+b.status)}catch(r){if(console.error("Error updating user password:",r),i.isAxiosError(r)&&r.response){const h=r.response.data.error||"Error al actualizar la información de usuario.";console.error("Error details:",r.response.data),m(`Error al actualizar su contraseña: ${h}. Por favor, intente una contraseña diferente.`)}else m("Error de conexión al actualizar su contraseña. Verifique su conexión a internet e intente de nuevo.")}}catch(r){console.error("Error in account setup process:",r),m("Ocurrió un error al configurar su cuenta. Por favor, intente nuevamente.")}finally{v(!1)}}};return e.jsx(B,{size:"lg",my:40,children:e.jsxs(R,{radius:"md",p:"xl",withBorder:!0,children:[e.jsx($,{order:2,ta:"center",mb:"lg",children:"Complete su perfil"}),z&&e.jsx(E,{icon:e.jsx(M,{size:16}),title:"Error",color:"red",mb:"md",children:z}),e.jsxs("form",{onSubmit:n.onSubmit(D),children:[e.jsxs(t,{active:u,mb:"xl",children:[e.jsx(t.Step,{label:"Bienvenido",description:"Primeros pasos",children:e.jsxs(d,{gap:"md",mt:"md",children:[e.jsx(o,{size:"lg",children:"¡Bienvenido a la plataforma de gestión de propiedades!"}),e.jsx(o,{children:"Vamos a ayudarle a configurar su cuenta para que pueda comenzar a utilizar todas las funcionalidades de la plataforma."}),e.jsx(o,{children:"Este proceso solo tomará unos minutos. Necesitaremos completar los siguientes datos:"}),e.jsxs(l,{pl:"md",children:[e.jsx(o,{children:"• Información personal"}),e.jsx(o,{children:"• Contraseña de acceso"}),e.jsx(o,{children:"• Información de propiedades"}),e.jsx(o,{children:"• Datos bancarios"}),e.jsx(o,{children:"• Configuración de precios"}),e.jsx(o,{children:"• Términos y condiciones"})]}),e.jsx(p,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",children:"Su usuario ha sido creado con una contraseña temporal. Por seguridad, deberá cambiarla para continuar usando la plataforma."})]})}),e.jsx(t.Step,{label:"Información personal",description:"Datos personales",children:e.jsxs(d,{gap:"md",mt:"md",children:[e.jsx(c,{label:"Nombre completo",placeholder:"Juan Pérez",required:!0,...n.getInputProps("fullName")}),e.jsx(c,{label:"Teléfono",placeholder:"+57 300 123 4567",required:!0,...n.getInputProps("phone")}),e.jsxs(A,{grow:!0,children:[e.jsx(x,{label:"Tipo de identificación",placeholder:"Seleccione tipo",data:[{value:"RC",label:"RC - Registro Civil"},{value:"TI",label:"TI - Tarjeta de Identidad"},{value:"CC",label:"CC - Cédula de Ciudadanía"},{value:"CE",label:"CE - Cédula de Extranjería"},{value:"PP",label:"PP - Pasaporte"},{value:"PEP",label:"PEP - Permiso Especial de Permanencia"},{value:"NIT",label:"NIT - Número de Identificación Tributaria"}],...n.getInputProps("identificationType")}),e.jsx(c,{label:"Número de identificación",placeholder:"12345678",...n.getInputProps("identificationNumber")})]}),e.jsx(c,{label:"Dirección",placeholder:"Calle 123 #45-67",...n.getInputProps("address")}),e.jsx(p,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",children:"Esta información nos ayudará a personalizar su experiencia y a contactarle cuando sea necesario."})]})}),e.jsx(t.Step,{label:"Seguridad",description:"Contraseña",children:e.jsxs(d,{gap:"md",mt:"md",children:[e.jsx(S,{label:"Nueva contraseña",placeholder:"Su nueva contraseña",required:!0,...n.getInputProps("password")}),e.jsx(S,{label:"Confirmar contraseña",placeholder:"Confirme su nueva contraseña",required:!0,...n.getInputProps("confirm_password")}),e.jsx(p,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",children:"Su contraseña debe tener al menos 8 caracteres. Use una combinación de letras, números y símbolos para mayor seguridad."})]})}),e.jsx(t.Step,{label:"Propiedades",description:"Información de propiedad",children:e.jsxs(d,{gap:"md",mt:"md",children:[e.jsx(c,{label:"Nombre de la propiedad",placeholder:"Apartamento Centro",...n.getInputProps("propertyName")}),e.jsx(c,{label:"Dirección de la propiedad",placeholder:"Calle 123 #45-67",required:!0,...n.getInputProps("propertyAddress")}),e.jsx(L,{label:"Descripción",placeholder:"Apartamento de 2 habitaciones, 1 baño...",minRows:3,...n.getInputProps("propertyDescription")}),e.jsx(x,{label:"Tipo de propiedad",placeholder:"Seleccione el tipo",data:[{value:"Apartment",label:"Apartamento"},{value:"House",label:"Casa"},{value:"Room",label:"Habitación"},{value:"Office",label:"Oficina"},{value:"Commercial",label:"Local comercial"},{value:"Other",label:"Otro"}],...n.getInputProps("propertyType")}),e.jsx(p,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",children:"Puede agregar más propiedades más adelante desde el panel de administración."})]})}),e.jsx(t.Step,{label:"Cuenta bancaria",description:"Datos bancarios",children:e.jsxs(d,{gap:"md",mt:"md",children:[e.jsx(c,{label:"Nombre del banco",placeholder:"Banco de Colombia",...n.getInputProps("bankName")}),e.jsx(c,{label:"Número de cuenta",placeholder:"1234567890",required:!0,...n.getInputProps("accountNumber")}),e.jsx(x,{label:"Tipo de cuenta",placeholder:"Seleccione el tipo",data:[{value:"Checking",label:"Cuenta Corriente"},{value:"Savings",label:"Cuenta de Ahorros"}],...n.getInputProps("accountType")}),e.jsx(c,{label:"Titular de la cuenta",placeholder:"Nombre del titular",...n.getInputProps("accountHolderName")}),e.jsx(p,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",children:"Esta cuenta se utilizará para los pagos y transferencias relacionados con sus propiedades."})]})}),e.jsx(t.Step,{label:"Precios",description:"Configuración de tarifas",children:e.jsxs(d,{gap:"md",mt:"md",children:[e.jsx(j,{label:"Precio base de alquiler",placeholder:"1000000",suffix:" COP",...n.getInputProps("baseRentalPrice")}),e.jsx(j,{label:"Monto de depósito",placeholder:"2000000",suffix:" COP",...n.getInputProps("depositAmount")}),e.jsx(j,{label:"Porcentaje de mora por pagos tardíos",placeholder:"5",suffix:"%",min:0,max:100,...n.getInputProps("lateFeePercentage")}),e.jsx(p,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",children:"Estos valores se utilizarán como referencia para sus propiedades. Puede personalizar los precios para cada propiedad más adelante."})]})}),e.jsx(t.Step,{label:"Términos y condiciones",description:"Aceptar términos",children:e.jsxs(d,{gap:"md",mt:"md",children:[e.jsx(o,{size:"lg",children:"Términos y Condiciones de Uso"}),e.jsx(l,{style:{maxHeight:"300px",overflow:"auto",padding:"15px",border:"1px solid #eee",borderRadius:"8px",backgroundColor:"#f9f9f9"},children:e.jsxs(o,{size:"sm",children:[e.jsx(o,{fw:700,mb:8,children:"Términos y Condiciones de Uso"}),e.jsx(o,{mb:16,children:"Al utilizar nuestra plataforma de gestión de propiedades, usted acepta cumplir con nuestros términos y condiciones, que incluyen:"}),e.jsxs(l,{component:"ul",pl:16,mb:16,children:[e.jsx(l,{component:"li",mb:4,children:"Proporcionar información precisa y veraz sobre usted y sus propiedades."}),e.jsx(l,{component:"li",mb:4,children:"Mantener la confidencialidad de su cuenta y contraseña."}),e.jsx(l,{component:"li",mb:4,children:"Notificar inmediatamente sobre cualquier uso no autorizado de su cuenta."}),e.jsx(l,{component:"li",mb:4,children:"No utilizar la plataforma para actividades ilegales o fraudulentas."}),e.jsx(l,{component:"li",mb:4,children:"Cumplir con todas las leyes y regulaciones aplicables."})]}),e.jsx(o,{mb:16,children:"Nos reservamos el derecho de suspender o terminar su acceso a la plataforma si consideramos que ha violado estos términos. El uso de esta plataforma implica el pago de tarifas según el plan seleccionado. Los pagos no son reembolsables una vez procesados."}),e.jsx(o,{fw:700,mb:8,children:"Consulta y Reporte en Centrales de Riesgo"}),e.jsx(o,{mb:16,children:"Usted autoriza expresamente a nuestra empresa para consultar y reportar su información financiera, crediticia, comercial y de servicios ante las centrales de riesgo autorizadas en Colombia, tales como DataCrédito y TransUnion, en los términos establecidos por la Ley 1266 de 2008 y la Ley 2157 de 2021."}),e.jsx(o,{mb:16,children:"Esta autorización es necesaria para evaluar su comportamiento crediticio y cumplir con las obligaciones legales relacionadas con la prevención del fraude y la gestión del riesgo."}),e.jsx(o,{mb:16,children:"En cumplimiento de la normativa vigente, se le informará previamente mediante comunicación escrita con al menos veinte (20) días de antelación antes de realizar cualquier reporte negativo a las centrales de riesgo, otorgándole la oportunidad de ejercer sus derechos de defensa y rectificación, conforme a lo dispuesto en el artículo 12 de la Ley 1266 de 2008."}),e.jsx(o,{mb:16,children:"Usted tiene derecho a conocer, actualizar y rectificar su información personal contenida en las bases de datos de las centrales de riesgo, de acuerdo con lo establecido en la Ley 1266 de 2008 y la Ley 1581 de 2012."}),e.jsx(o,{fw:700,mb:8,children:"Superintendencia de Industria y Comercio"}),e.jsxs(o,{mb:16,children:["Para más información sobre sus derechos y las políticas de tratamiento de datos personales, le recomendamos consultar la página oficial de la Superintendencia de Industria y Comercio:",e.jsx(o,{component:"a",href:"https://www.sic.gov.co/sobre-el-habeas-data-financiero",target:"_blank",c:"blue",children:"https://www.sic.gov.co/sobre-el-habeas-data-financiero"}),"."]})]})}),e.jsx(O,{label:"He leído y acepto los términos y condiciones",required:!0,...n.getInputProps("termsAccepted",{type:"checkbox"})}),e.jsx(p,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",children:"Es necesario aceptar los términos y condiciones para utilizar la plataforma."})]})}),e.jsx(t.Step,{label:"Finalizar",description:"Completar registro",children:e.jsxs(d,{gap:"md",mt:"md",children:[e.jsx(o,{size:"lg",children:"¡Todo listo!"}),e.jsx(o,{children:'Ha completado todos los pasos necesarios para configurar su cuenta. Pulse el botón "Completar" para finalizar y comenzar a utilizar la plataforma.'}),e.jsxs(E,{color:"blue",children:[e.jsx(o,{children:"Después de completar este proceso, su cuenta quedará en estado de espera de aprobación por parte del administrador."}),e.jsx(o,{fw:500,mt:"xs",children:"Podrá acceder al sistema, pero algunas funcionalidades estarán limitadas hasta que su cuenta sea activada completamente."})]}),e.jsxs(l,{mt:"xl",children:[e.jsx(p,{my:"md"}),e.jsx(o,{size:"sm",color:"dimmed",ta:"center",mb:"md",children:"Para cualquier consulta, comuníquese con nuestro equipo de soporte a través de nescool101@gmail.com"})]})]})})]}),e.jsxs(A,{justify:"apart",mt:"xl",children:[e.jsx(y,{variant:"default",onClick:_,disabled:u===0,children:"Atrás"}),u===7?e.jsx(y,{type:"submit",disabled:C,children:C?e.jsx(F,{size:"sm"}):"Completar"}):e.jsx(y,{onClick:N,children:"Siguiente"})]})]})]})})}export{Y as default};
