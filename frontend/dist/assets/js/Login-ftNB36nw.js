import{j as e,E as A,m as S,S as I,b as v,k as w,B as C,K as z,C as L,P as R,a as k,t as E,y as q,p as y,G as _,n as M}from"./mantine-vendor-Bripv_3X.js";import{r as a}from"./react-vendor-Cmr1RT9l.js";import{g as D,I as P,u as O}from"./index-BGAR1JXy.js";import"./utils-vendor-tZ1hTSV2.js";function $({opened:u,onClose:c}){const[t,i]=a.useState(""),[m,d]=a.useState(!1),[p,n]=a.useState(!1),[f,o]=a.useState(""),g=async r=>{if(r.preventDefault(),!t||!/^\S+@\S+$/.test(t)){o("Por favor, ingrese un email válido");return}d(!0),o("");try{await new Promise(h=>setTimeout(h,1e3)),n(!0),setTimeout(()=>{n(!1),i(""),c()},3e3)}catch{o("Error al enviar el email de recuperación. Intente nuevamente.")}finally{d(!1)}},x=()=>{i(""),o(""),n(!1),c()};return e.jsx(A,{opened:u,onClose:x,title:"Recuperar Contraseña",centered:!0,children:p?e.jsx(S,{icon:e.jsx(D,{size:16}),title:"Email enviado",color:"green",children:"Se ha enviado un email con instrucciones para recuperar su contraseña."}):e.jsx("form",{onSubmit:g,children:e.jsxs(I,{children:[e.jsx(v,{size:"sm",c:"dimmed",children:"Ingrese su email y le enviaremos instrucciones para recuperar su contraseña."}),f&&e.jsx(S,{icon:e.jsx(P,{size:16}),title:"Error",color:"red",children:f}),e.jsx(w,{label:"Email",placeholder:"tu@email.com",value:t,onChange:r=>i(r.target.value),required:!0}),e.jsx(C,{type:"submit",loading:m,fullWidth:!0,children:"Enviar instrucciones"})]})})})}const b=3;function V(){const[u,c]=a.useState(!1),[t,i]=a.useState(!1),[m,d]=a.useState(0),[p,n]=a.useState(""),[f,o]=a.useState(!1),{login:g,register:x}=O();a.useEffect(()=>{n("")},[t]),a.useEffect(()=>{const s=localStorage.getItem("last_auth_error");s&&(n(s),localStorage.removeItem("last_auth_error"))},[u]);const r=z({initialValues:{email:"",password:"",confirmPassword:"",name:"",terms:!1},validate:{email:s=>/^\S+@\S+$/.test(s)?null:"Email inválido",password:s=>s.length<6?"La contraseña debe tener al menos 6 caracteres":null,confirmPassword:(s,l)=>t&&s!==l.password?"Las contraseñas no coinciden":null,name:s=>t&&s.trim().length<2?"El nombre es requerido":null,terms:s=>t&&!s?"Debes aceptar los términos y condiciones":null}}),h=async s=>{c(!0),n("");try{let l=!1;if(t)l=await x(s.name,s.email,s.password),l&&(i(!1),r.setValues({email:s.email,password:"",confirmPassword:"",name:"",terms:!1}));else if(l=await g(s.email,s.password),!l){const T=new CustomEvent("get-last-auth-error");window.dispatchEvent(T);const j=m+1;d(j),j>=b&&(n(`Demasiados intentos fallidos (${j}/${b}). Serás redirigido a la página principal.`),setTimeout(()=>{M.show({title:"Demasiados intentos",message:"Redirigiendo a la página principal",color:"red"}),window.location.href="/"},2e3))}}finally{c(!1)}};return e.jsxs(L,{size:420,my:40,children:[e.jsxs(R,{radius:"md",p:"xl",withBorder:!0,children:[e.jsx(k,{order:2,ta:"center",mb:"lg",children:t?"Crear una cuenta":"Iniciar sesión"}),p&&e.jsx(S,{icon:e.jsx(P,{size:16}),title:"Error de autenticación",color:"red",mb:"md",children:p}),e.jsxs("form",{onSubmit:r.onSubmit(h),children:[e.jsxs(I,{children:[t&&e.jsx(w,{label:"Nombre completo",placeholder:"Tu nombre",required:!0,...r.getInputProps("name")}),e.jsx(w,{label:"Email",placeholder:"tu@email.com",required:!0,...r.getInputProps("email")}),e.jsx(E,{label:"Contraseña",placeholder:"Tu contraseña",required:!0,...r.getInputProps("password")}),t&&e.jsxs(e.Fragment,{children:[e.jsx(E,{label:"Confirmar contraseña",placeholder:"Confirma tu contraseña",required:!0,...r.getInputProps("confirmPassword")}),e.jsx(q,{label:"Acepto los términos y condiciones",...r.getInputProps("terms",{type:"checkbox"})})]}),!t&&e.jsx(y,{component:"button",type:"button",c:"dimmed",size:"sm",onClick:()=>o(!0),style:{alignSelf:"flex-start"},children:"¿Olvidó su contraseña?"})]}),e.jsxs(_,{justify:"space-between",mt:"md",children:[t?e.jsx(y,{component:"button",type:"button",c:"dimmed",onClick:()=>i(!1),size:"sm",children:"¿Ya tienes una cuenta? Inicia sesión"}):e.jsx(v,{size:"sm",c:"dimmed",children:"El registro solo está disponible para usuarios autorizados"}),e.jsx(C,{type:"submit",loading:u,disabled:m>=b,children:t?"Registrarse":"Iniciar sesión"})]})]})]}),e.jsx($,{opened:f,onClose:()=>o(!1)})]})}export{V as default};
