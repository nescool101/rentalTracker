import{K as F,j as e,C as P,S as p,G as o,a as x,r as m,m as B,b as t,a0 as c,P as S,l as V,k as I,x as N,B as $,Z as K,e as z,q as s,n as g}from"./mantine-vendor-Bripv_3X.js";import{r as E}from"./react-vendor-Cmr1RT9l.js";import{c as R,u as C,d as Q,a as O}from"./utils-vendor-tZ1hTSV2.js";import{c as b,l as H,o as X,n as Z,g as J,a as W}from"./index-BGAR1JXy.js";import{u as Y}from"./apiService-19GZqUtM.js";import{I as ee}from"./IconUpload-InkA3i1s.js";import{I as ae}from"./IconRefresh-c4GWuNKm.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var se=b("outline","clock","IconClock",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 7v5l3 3",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ne=b("outline","external-link","IconExternalLink",[["path",{d:"M12 6h-6a2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-6",key:"svg-0"}],["path",{d:"M11 13l9 -9",key:"svg-1"}],["path",{d:"M15 4h5v5",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var re=b("outline","info-circle","IconInfoCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]]);const j=O.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});j.interceptors.request.use(r=>{const d=W.getToken();return d&&(r.headers.Authorization=`Bearer ${d}`),r},r=>Promise.reject(r));const _={generateUploadLink:async r=>(await j.post("/admin/file-upload/generate-link",r)).data,getUploadTokens:async()=>(await j.get("/admin/file-upload/tokens")).data};function he(){var k;const[r,d]=E.useState("generate"),[w,v]=E.useState(!1),L=R(),i=F({initialValues:{recipient_email:"",recipient_name:"",user_id:"",expiration_days:7},validate:{recipient_email:a=>/^\S+@\S+$/.test(a)?null:"Email inv√°lido",recipient_name:a=>a.length<2?"Nombre debe tener al menos 2 caracteres":null,user_id:a=>a.length===0?"Debe seleccionar un usuario":null,expiration_days:a=>a<1||a>365?"Debe ser entre 1 y 365 d√≠as":null}}),{data:h,isLoading:f,refetch:U}=C({queryKey:["uploadTokens"],queryFn:_.getUploadTokens,enabled:r==="tokens"}),{data:u,isLoading:y}=C({queryKey:["users"],queryFn:Y.getAll,enabled:r==="generate"}),q=Q({mutationFn:_.generateUploadLink,onSuccess:a=>{g.show({title:"‚úÖ Enlace Generado",message:`Enlace de subida enviado a ${a.recipient}`,color:"green",icon:e.jsx(J,{size:16})}),i.reset(),L.invalidateQueries({queryKey:["uploadTokens"]})},onError:a=>{var n,l;g.show({title:"‚ùå Error",message:((l=(n=a.response)==null?void 0:n.data)==null?void 0:l.error)||"Error generando enlace",color:"red",icon:e.jsx(Z,{size:16})})},onSettled:()=>{v(!1)}}),A=a=>{v(!0),q.mutate(a)},M=a=>{if(a&&u){const n=u.find(l=>l.id===a);n&&(i.setFieldValue("user_id",a),i.setFieldValue("recipient_email",n.email),n.person_id&&i.setFieldValue("recipient_name",n.email))}},D=(u==null?void 0:u.map(a=>({value:a.id,label:`${a.email} (${a.role})`})))||[],T=a=>new Date(a).toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),G=a=>{const n=new Date,l=new Date(a.expires_at);return a.used?{label:"Usado",color:"blue"}:n>l?{label:"Expirado",color:"red"}:{label:"Activo",color:"green"}};return e.jsx(P,{size:"xl",mt:20,children:e.jsxs(p,{gap:"lg",children:[e.jsxs(o,{justify:"space-between",children:[e.jsx(x,{order:2,children:"üìÅ Gesti√≥n de Subida de Archivos"}),e.jsxs(o,{children:[e.jsx(m,{color:"blue",variant:"light",children:"Solo PDFs e Im√°genes"}),e.jsx(m,{color:"green",variant:"light",children:"Admin/Manager"})]})]}),e.jsx(B,{icon:e.jsx(re,{size:16}),color:"blue",variant:"light",children:e.jsxs(t,{size:"sm",children:[e.jsx("strong",{children:"Informaci√≥n:"})," Los archivos se suben directamente a Google Drive. Los enlaces generados tienen validez temporal y son √∫nicos por destinatario."]})}),e.jsxs(c,{value:r,onChange:a=>d(a||"generate"),children:[e.jsxs(c.List,{children:[e.jsx(c.Tab,{value:"generate",leftSection:e.jsx(H,{size:16}),children:"Generar Enlace"}),e.jsx(c.Tab,{value:"tokens",leftSection:e.jsx(se,{size:16}),children:"Tokens Activos"})]}),e.jsx(c.Panel,{value:"generate",pt:"lg",children:e.jsx(S,{p:"xl",withBorder:!0,children:e.jsxs(p,{gap:"md",children:[e.jsx(x,{order:3,children:"üì§ Generar Enlace de Subida"}),e.jsx(t,{c:"dimmed",children:"Env√≠a un enlace seguro a una persona para que pueda subir documentos al sistema."}),e.jsx("form",{onSubmit:i.onSubmit(A),children:e.jsxs(p,{gap:"md",children:[e.jsx(V,{label:"Seleccionar Usuario",placeholder:y?"Cargando usuarios...":"Seleccione un usuario",data:D,searchable:!0,clearable:!0,leftSection:e.jsx(X,{size:16}),disabled:y,required:!0,...i.getInputProps("user_id"),onChange:M}),e.jsxs(o,{grow:!0,children:[e.jsx(I,{label:"Nombre del Destinatario",placeholder:"Se completa autom√°ticamente",required:!0,disabled:!0,...i.getInputProps("recipient_name")}),e.jsx(I,{label:"Email del Destinatario",placeholder:"Se completa autom√°ticamente",type:"email",required:!0,disabled:!0,...i.getInputProps("recipient_email")})]}),e.jsx(N,{label:"D√≠as de Validez",description:"N√∫mero de d√≠as que el enlace estar√° activo",placeholder:"7",min:1,max:365,...i.getInputProps("expiration_days")}),e.jsx(o,{justify:"flex-end",mt:"md",children:e.jsx($,{type:"submit",leftSection:e.jsx(ee,{size:16}),loading:w,disabled:!i.isValid(),children:"Generar y Enviar Enlace"})})]})})]})})}),e.jsx(c.Panel,{value:"tokens",pt:"lg",children:e.jsx(S,{p:"xl",withBorder:!0,children:e.jsxs(p,{gap:"md",children:[e.jsxs(o,{justify:"space-between",children:[e.jsx(x,{order:3,children:"üé´ Tokens de Subida"}),e.jsx(K,{label:"Actualizar lista",children:e.jsx(z,{variant:"light",onClick:()=>U(),loading:f,children:e.jsx(ae,{size:16})})})]}),f?e.jsx(t,{ta:"center",py:"xl",children:"Cargando tokens..."}):((k=h==null?void 0:h.tokens)==null?void 0:k.length)>0?e.jsxs(s,{striped:!0,highlightOnHover:!0,children:[e.jsx(s.Thead,{children:e.jsxs(s.Tr,{children:[e.jsx(s.Th,{children:"Destinatario"}),e.jsx(s.Th,{children:"Email"}),e.jsx(s.Th,{children:"Creado"}),e.jsx(s.Th,{children:"Expira"}),e.jsx(s.Th,{children:"Estado"}),e.jsx(s.Th,{children:"Token"})]})}),e.jsx(s.Tbody,{children:h.tokens.map(a=>{const n=G(a);return e.jsxs(s.Tr,{children:[e.jsx(s.Td,{children:e.jsx(t,{fw:500,children:a.name})}),e.jsx(s.Td,{children:e.jsx(t,{size:"sm",c:"dimmed",children:a.email})}),e.jsx(s.Td,{children:e.jsx(t,{size:"sm",children:T(a.created_at)})}),e.jsx(s.Td,{children:e.jsx(t,{size:"sm",children:T(a.expires_at)})}),e.jsx(s.Td,{children:e.jsx(m,{color:n.color,variant:"light",size:"sm",children:n.label})}),e.jsx(s.Td,{children:e.jsxs(o,{gap:"xs",children:[e.jsxs(t,{size:"xs",c:"dimmed",style:{fontFamily:"monospace"},children:[a.token.substring(0,16),"..."]}),e.jsx(z,{size:"sm",variant:"light",onClick:()=>{navigator.clipboard.writeText(a.token),g.show({message:"Token copiado al portapapeles",color:"blue"})},children:e.jsx(ne,{size:12})})]})})]},a.token)})})]}):e.jsx(t,{ta:"center",py:"xl",c:"dimmed",children:"No hay tokens generados a√∫n"})]})})})]})]})})}export{he as default};
